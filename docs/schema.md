# Схема данных: Task Tracker Analysis

## Обзор структуры

Проект использует две основные таблицы с отношением "многие к одному":

```
issues (51,955 записей)
├── resolution → resolutions.id
└── category (4 уникальных значения)

resolutions (176 записей)
└── используются только 5
```

---

## Таблица `issues`

### Назначение
Хранит историческую запись о всех тикетах системы трекинга задач с датами создания, решения, типом исхода и категорией.

### Структура полей

| Поле | Тип | Nullable | Описание |
|------|-----|----------|---------|
| `key` | TEXT | NO | Уникальный идентификатор тикета (например, `JIRA-12345`) |
| `created` | BIGINT | NO | Unix timestamp в миллисекундах — момент создания тикета |
| `resolved` | BIGINT | YES | Unix timestamp в миллисекундах — момент решения (NULL для открытых) |
| `resolution` | TEXT | YES | ID типа резолюции (FK на `resolutions.id`); NULL для открытых тикетов |
| `category` | TEXT | NO | Категория тикета (4 возможных значения) |

### Примеры значений

```
key         | created          | resolved         | resolution | category
------------|------------------|------------------|------------|------------------
JIRA-00001  | 1704067200000    | 1704153600000    | 4f6b29cc   | Local
JIRA-00002  | 1704153600000    | 1704240000000    | 5a2c3def   | Remote
JIRA-00003  | 1704240000000    | NULL             | NULL       | New User
JIRA-00004  | 1704326400000    | 1704412800000    | 4f6b29cc   | Software License
```

### Диапазон данных

- **Период:** примерно 2 года исторических данных
- **Формат timestamp:** Unix time в миллисекундах (мс), а не секундах
- **Пример конвертации:** 1704067200000 мс = 2024-01-01 00:00:00 UTC

### Аномалии и особенности

| Тип | Количество | Описание | Обработка |
|-----|-----------|---------|-----------|
| Пропуски `created` | 3 (0.006%) | Некорректная дата создания | Исключены из анализа |
| Пропуски `resolved` | 2,766 (5.32%) | Открытые тикеты (ожидаемо) | Анализируются отдельно как backlog |
| Epoch аномалии | 2 | `created < 1000000000000` (примерно < 2001 года) | Фильтруются в VIEW `issues_clean` |
| resolved < created | 0 | Логическая ошибка | Не обнаружена |
| Долгие тикеты | 3 | `days_to_resolve > 365` | Анализируются как "хвост" распределения |

---

## Таблица `resolutions`

### Назначение
Справочник типов исходов для классификации решённых тикетов.

### Структура полей

| Поле | Тип | Nullable | Описание |
|------|-----|----------|---------|
| `id` | TEXT | NO | Уникальный идентификатор резолюции (например, UUID) |
| `key` | TEXT | NO | Человеческое название резолюции (например, `fixed`, `wontFix`) |

### Возможные значения `key`

| Название | Использование | Интерпретация |
|----------|------|------------|
| `Fixed` | 46,808 (95.17%) | Проблема решена, реально исправлено |
| `Wont Fix` | 1,251 (2.54%) | Решено не делать (по причине: низкий приоритет, не в зоне ответственности, и т.д.) |
| `resolvedByUser` | 791 (1.61%) | Пользователь самостоятельно решил проблему (например, нашёл ответ в FAQ) |
| `Duplicate` | 294 (0.6%) | Это дубликат другого существующего тикета |
| `escalated` | 39 (0.08%) | Эскалировано на более высокий уровень |

### Избыточность справочника

```
Всего резолюций в справочнике:    176
Реально используемых:               5
Неиспользуемых:                   171 (97.16%)
```

**Проблема:** Справочник содержит множество неиспользуемых записей, что может быть признаком:
- Устаревших резолюций, которые больше не применяются
- Дублирования записей
- Слабой дисциплины в очистке справочников

**Рекомендация:** Проводить регулярную ревизию справочника и удалять/архивировать неиспользуемые записи.

---

## Связи между таблицами

### Foreign Key: `issues.resolution → resolutions.id`

```
issues.resolution  │   resolutions.id
─────────────────────────────────────────
4f6b29cc...        │──→ 4f6b29cc... (key: "Fixed")
5a2c3def...        │──→ 5a2c3def... (key: "Wont Fix")
NULL               │    (для открытых тикетов)
```

### Проблемы связности

- **Найдено 1 тикета** с `resolution`, отсутствующей в `resolutions`
  - Возможная причина: удаление записи из справочника без обновления данных
  - Действие: требуется исправление данных

---

## Витрина `issues_clean` (VIEW)

### Назначение
Создана в `sql/02_data_cleaning.sql` как очищенный слой для аналитики с преобразованиями и фильтрами.

### Дополнительные поля

| Поле | Источник | Описание |
|------|----------|---------|
| `created_dt` | `created` мс / 1000 → TO_TIMESTAMP() | Дата/время создания (тип TIMESTAMP) |
| `resolved_dt` | `resolved` мс / 1000 → TO_TIMESTAMP() | Дата/время решения (тип TIMESTAMP) |
| `created_raw` | `created` | Оригинальное значение (для отладки) |
| `resolved_raw` | `resolved` | Оригинальное значение (для отладки) |
| `days_to_resolve` | (resolved - created) / 1000 / 60 / 60 / 24 | Время решения в днях (float) |

### Преобразования

```sql
-- Конвертация timestamp
created_raw = 1704067200000  →  created_dt = '2024-01-01 00:00:00'

-- Расчёт дней (пример)
(1704153600000 - 1704067200000) / 1000 / 60 / 60 / 24 = 1.0 день

-- Фильтрация
WHERE created > 1000000000000  -- исключает epoch аномалии (до 2001 года)
```

### Объём витрины

```
Всего записей в issues:     51,955
После фильтрации:           51,950 (исключено 5 anomalies)
Из них:
  - Решённые:               49,184 (94.67%)
  - Открытые:                2,766 (5.33%)
```

---

## Индексы

Созданы для оптимизации JOIN и фильтров:

| Индекс | На таблице | На поле | Назначение |
|--------|-----------|--------|-----------|
| `idx_issues_resolution` | issues | resolution | Ускоряет JOIN с resolutions |
| `idx_issues_category` | issues | category | Ускоряет фильтр по категориям |
| `idx_issues_created` | issues | created | Ускоряет фильтры по дате создания, сортировку |
| `idx_issues_resolved` | issues | resolved | Ускоряет фильтры по дате решения |

---

## Распределение данных

### По категориям

| Категория | Количество | % | Описание |
|-----------|-----------|---|---------|
| Local | 26,366 | 50.75% | Локальные / на месте проблемы |
| Remote | 18,167 | 34.97% | Удалённые проблемы |
| New User | 6,144 | 11.83% | Проблемы новых пользователей |
| Software License | 1,273 | 2.45% | Проблемы с лицензионным ПО |
| **Всего** | **51,950** | **100%** | |

### По статусу

| Статус | Количество | % |
|--------|-----------|---|
| Решённые | 49,184 | 94.67% |
| Открытые | 2,766 | 5.33% |
| **Всего** | **51,950** | **100%** |

### По резолюциям (для решённых)

| Резолюция | Количество | % |
|-----------|-----------|---|
| Fixed | 46,808 | 95.17% |
| Wont Fix | 1,251 | 2.54% |
| resolvedByUser | 791 | 1.61% |
| Duplicate | 294 | 0.60% |
| escalated | 39 | 0.08% |
| **Всего** | **49,183** | **100%** |
